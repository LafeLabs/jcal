<!doctype html>
<html lang="en">
<head>
   <meta charset="utf-8">
   <!--
    Organic Web Home page
   -->


<link href="data:image/x-icon;base6r4,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAP//AP///wANAP8A5Dz6ABueRwAAt/8A6BonABo86AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAREREREREREREREAAAEREREREQCIgREREd3dwAAB3d3d3d3d3d3d3d3d3d3d3d3d3VVVVVVVQAFVVAAVVVQIiBRAiIBEQIAIBECAAERAgAgFgIABmYCIiBmAiIGZgIiIGYCIgZmYCIAaIAAMzMzAAiIiIiIiIiIiIiIiIiIiIiIgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA" rel="icon" type="image/x-icon">

   <title>List files</title>    
   <script type="module" src="track-list.js"></script>   
   <script src = "https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>    
<a id = "markdownlink" href = "read-markdown-files.html">Read markdown files</a>
<a id = "homelink" href = "index.html">Home</a>

    <H1>List Files</H1>
<textarea id = "text"></textarea>
<style>
body{
    font-family:arial;
}
#homelink{
    position:absolute;
    right:5px;
    top:5px;
    z-index:2;
    font-size:2em;
    color:blue;
}
#markdownlink{
    position:absolute;
    left:5px;
    top:5px;
    z-index:2;
    font-size:2em;
    color:blue;
}

h1{
    width:100%;
    text-align:center;
}
#text{
    width:90%;
    position:absolute;
    left:5%;
    top:5em;
    bottom:1em;
}
</style>
<script>

files = [];

var httpcUpload = new XMLHttpRequest();
httpcUpload.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        files = JSON.parse(this.responseText);
        loadfiles();
    }
};
httpcUpload.open("GET", "list-files.php", true);
httpcUpload.send();


text = "";

function loadfiles(){

    text += "\n# Web Files\n\n";
    for(var index = 0;index < files.length;index++){
        if(files[index].substring(files[index].length-5,files[index].length) == ".html" || files[index].substring(files[index].length-5,files[index].length) == ".json" || files[index].substring(files[index].length-3,files[index].length) == ".js" ||files[index].substring(files[index].length-4,files[index].length) == ".css" || files[index].substring(files[index].length-4,files[index].length) == ".php"){
            text += " - [" + files[index] + "](" + files[index] + ")\n";
        }
    }    


    text += "\n# Images\n\n";
    for(var index = 0;index < files.length;index++) {
        if(files[index].includes(".png") || files[index].includes(".PNG") || files[index].includes(".jpg") || files[index].includes(".JPG") ||files[index].includes(".jpeg")||files[index].includes(".SVG") ||files[index].includes(".svg") || files[index].includes(".gif") ||files[index].includes(".GIF")){
            text += "# " + files[index] + "\n\n";
            text += "![](" + files[index] + ")\n";
        }
    }   

    text += "\n# All other files\n\n";

    for(var index = 0;index < files.length;index++) {
        if(!files[index].includes(".png") && !files[index].includes(".PNG") && !files[index].includes(".jpg") && !files[index].includes(".JPG")  && !files[index].includes(".jpeg") && !files[index].includes(".SVG") && !files[index].includes(".svg") && !files[index].includes(".gif") && !files[index].includes(".GIF") && !files[index].includes(".html") && !files[index].includes(".css") && !files[index].includes(".json") && !files[index].includes(".js") && !files[index].includes(".php") && files[index].includes(".")){
            
            text += " - [" + files[index] + "](" + files[index] + ")\n";
        
        }    
    }
     
    text += "\n# Folders\n\n";

    
    directories = [];
    var httpc2 = new XMLHttpRequest();
        httpc2.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            directories = JSON.parse(this.responseText);
            for(var index = 0;index < directories.length;index++) {
                text += " - [" + directories[index] + "/](" + directories[index] + "/)\n";
            }
            document.getElementById("text").value = text;
            savetextfile();
        }
    };
    
    httpc2.open("GET", "list-branches.php", true);
    httpc2.send();
    
    
}


function savetextfile(){
    data = encodeURIComponent(text);
    var httpc = new XMLHttpRequest();
    var url = "save-file.php";        
    httpc.open("POST", url, true);
    httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
    httpc.send("data="+data+"&filename=file-list.md");//send text to save-file.php
}






</script>
</body>
</html>


    
    
